gal_neworder_indx <-  c(5,1,11,4,10,2,3,6,7,8,9)
gal_inds_neworder_agesex <- c("Gus", "Quasar", "Cometa", "Lucero", "Luna", "Estrella","Venus", "Orbita", "Planeta", "Saturno", "Pluto") #same as above
sex_matrix <- sex_matrix[gal_inds_neworder_agesex, gal_inds_neworder_agesex]
age_matrix <- age_matrix[gal_inds_neworder_agesex, gal_inds_neworder_agesex]
# NOW WE HAVE ALL 4 MATRICES WITH THE SAME ORDER OF GROUP MEMBERS!
#png(height = 900, width = 1400, units = 'px', filename = paste0(plot_dir,'all_matrices.png'))
#par(mfrow=c(2,2))
visualize_network_matrix_galaxy(gal_matrix, coati_ids[gal_neworder_indx,])
mtext("1) Proportion of time each dyad was in the same subgroup", cex = 1.2)
visualize_network_matrix_galaxy(age_matrix, coati_ids[gal_neworder_indx,])
mtext("2) Age homophily", cex = 1.2)
visualize_network_matrix_galaxy(sex_matrix, coati_ids[gal_neworder_indx,])
mtext("3) Sex homophily", cex = 1.2)
visualize_network_matrix_galaxy(gen_matrix, coati_ids[gal_neworder_indx,])
mtext("4) Genetics - Triadic Maximum Likelihood method", cex = 1.2)
#dev.off()
#save these matrices to send to Tiffany
save(gal_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/galaxy_subgrouping.Rdata')
save(age_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/galaxy_age.Rdata')
save(sex_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/galaxy_sex.Rdata')
galaxy_gen_matrix <- gen_matrix
save(galaxy_gen_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/galaxy_relatedness.Rdata')
galaxy_ids <- coati_ids[gal_neworder_indx,]
save(galaxy_ids, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/galaxy_ids.Rdata')
#--------------------------------------------------------------------------
#MRQAP with Double-Semi-Partialing (DSP)
set.seed(2)
#table 2:
mod <- mrqap.dsp(gal_matrix~age_matrix+sex_matrix+gen_matrix, directed="undirected", diagonal = F)
mod
#age and sex don't influence the subgroup membership but genetics does
#write.csv(gal_matrix, file = "C:/Users/egrout/Dropbox/coatithon/processed/genetics/galaxy/gal_matrix.csv")
#write.csv(gen_matrix, file = "C:/Users/egrout/Dropbox/coatithon/processed/genetics/galaxy/gen_matrix.csv")
#Figure S6 - scatter plot for genetics and prop time together
png(height = 1000, width = 1000, units = 'px', filename = paste0(plot_dir,'gen_gal_scatter_2.png'))
par(mar=c(8,8,6,3), mgp=c(5,1.2,0))
gen_vec <- gen_matrix[upper.tri(gen_matrix)]
gal_vec <- gal_matrix[upper.tri(gal_matrix)]
df <- data.frame(cbind(gen_vec, gal_vec))
plot(df$gen_vec, df$gal_vec, ylab = "Proportion of time together", xlab = "Relatedness (Triadic Maximum Likelihood)", pch = 19, col = "darkolivegreen3", cex = 3, cex.lab = 3, cex.axis = 2.5, yaxt = "n", ylim = c(0.3,1))
axis(2, at = c(0,0.3,0.6,0.9), cex.axis = 3, las = 1)
abline(lm(gal_vec ~ gen_vec, data = data.frame(df)), col = "black", lwd = 2)
#str(summary(lm(gal_vec ~ gen_vec, data = data.frame(df)))) #rsquared = 0.182
dev.off()
#this script is getting the proportion of time Trago group members are together, and removing times when Tequila and Rum leave the group
#--------PARAMS-------
data_dir <- "C:/Users/egrout/Dropbox/coatithon/processed/2022/trago/"
code_dir <- 'C:/Users/egrout/Dropbox/coatithon/coatithon_code/code_review/'
plot_dir <- 'C:/Users/egrout/Dropbox/coatithon/results/trago_results/'
gps_file <- "trago_xy_10min_level0_all.RData"
id_file <- 'trago_coati_ids_all.RData'
#I manually made these matrices in excel - of the dyad are the same age/sex, they get 1, if different, they get 0
#load these matrices in from the GoogleDrive
sex_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/trago/trago_sex_matrix.csv', header = T)
age_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/trago/trago_age_matrix.csv', header = T)
#read in the genetics matrix for all groups
all_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/CoatiTrioMLmatrix.csv', header = T)
#-------SETUP-------
library(fields)
library(viridis)
library(tidyverse)
library(sna)
library(asnipe)
library(abind)
#read in library of functions
setwd(code_dir)
source('coati_function_library_V1.R')
#load data
setwd(data_dir)
load(gps_file)
load(id_file)
#-----MAIN------
n_inds <- nrow(xs)
n_times <- ncol(xs)
#number of individuals tracked at each time point
n_tracked <- colSums(!is.na(xs))
#indexes to time points where all individuals were tracked
all_tracked_idxs <- which(n_tracked==n_inds)
subgroup_data <- get_subgroup_data(xs, ys, R=50)
ff_net <- matrix(NA, nrow = n_inds, ncol = n_inds)
#going through each dyad and calculating fraction of time they are in the same subgroup (out of all time both are tracked)
for(i in 1:n_inds){
for(j in 1:n_inds){
#getting subgroup id for individual i and j
sub_ids_i <- subgroup_data$ind_subgroup_membership[i,]
sub_ids_j <- subgroup_data$ind_subgroup_membership[j,]
#computing edge weight (fraction of time in same subgroup)
ff_net[i,j] <- mean(sub_ids_i == sub_ids_j, na.rm=T)
}
}
diag(ff_net) <- NA
new_order <- c(2,3,7:9,1,5,4,6)
ffnet_reorder <- ff_net[new_order, new_order]
visualize_network_matrix_trago(ffnet_reorder, coati_ids[new_order,])
#get timestamp when Rum and Tequila not in group
#Tequila
#ts[180:1399]
#rum
#ts[320:1399]
xs[6, 180:1399] <- NA
ys[6, 180:1399] <- NA
xs[4, 320:1399] <- NA
ys[4, 320:1399] <- NA
subgroup_data <- get_subgroup_data(xs, ys, R=50)
ff_net <- matrix(NA, nrow = n_inds, ncol = n_inds)
for(i in 1:n_inds){
for(j in 1:n_inds){
sub_ids_i <- subgroup_data$ind_subgroup_membership[i,]
sub_ids_j <- subgroup_data$ind_subgroup_membership[j,]
ff_net[i,j] <- mean(sub_ids_i == sub_ids_j, na.rm=T)
}
}
diag(ff_net) <- NA
new_order <- c(1,2,3,7,8,9,4,5,6)
ffnet_reorder <- ff_net[new_order, new_order]
visualize_network_matrix_trago(ffnet_reorder, coati_ids[new_order,])
#--------------------------------------------------------------------
rownames(age_matrix) <- age_matrix$X
age_matrix <- age_matrix[,-1]
age_matrix <- as.matrix(age_matrix)
diag(age_matrix) <- NA
rownames(sex_matrix) <- sex_matrix$X
sex_matrix <- sex_matrix[,-1]
sex_matrix <- as.matrix(sex_matrix)
diag(sex_matrix) <- NA
trago_matrix <- ffnet_reorder
# G8 - Tequila
# G32 - Bailey
# G33 - Rum
# G34 - Whisky
# G35 - Sake
# G36 - Amarulla
# G37 - Tiger
# G38 - Limoncello
# G39 - Cerveza
#Amarulla, Limoncello, Whisky, Cerveza, Sake, Tiger, Bailey, Rum, Tequila
trago_neworder_indx <- c(2,3,7,8,9,1,5,4,6)
trago_inds_neworder <- c("G36", "G38","G34","G39", "G35","G37","G32","G33","G8")
#first column is index numbers but I want this to be the IDs
rownames(all_matrix) <- all_matrix$X
#remove first column as this is incorrect for the subsetting to work
all_matrix <- all_matrix[,-1]
gen_matrix <- all_matrix[trago_inds_neworder, trago_inds_neworder]
gen_matrix <- as.matrix(gen_matrix)
diag(gen_matrix) <- NA
#plot S3
n_inds <- 9
par(mfrow=c(1,1), mar = c(6,6,1,1)) #bottom, left, top, and right
visualize_network_matrix_trago(gen_matrix, coati_ids[trago_neworder_indx,])
visualize_network_matrix_trago(sex_matrix, coati_ids[trago_neworder_indx,])
visualize_network_matrix_trago(age_matrix, coati_ids[trago_neworder_indx,])
visualize_network_matrix_trago(trago_matrix, coati_ids[trago_neworder_indx,])
#save these matrices to send to Tiffany
save(trago_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/trago_subgrouping.Rdata')
save(age_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/trago_age.Rdata')
save(sex_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/trago_sex.Rdata')
trago_gen_matrix <- gen_matrix
save(trago_gen_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/trago_relatedness.Rdata')
trago_ids <- coati_ids[trago_neworder_indx,]
save(trago_ids, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/trago_ids.Rdata')
#this script is for the MRQAP analysis for Presidente group
#load in libraries
library(sna)
library(asnipe)
library(abind)
library(fields)
library(ecodist)
library(vegan)
data_dir <- "C:/Users/egrout/Dropbox/coatithon/processed/2023/presedente/"
code_dir <- 'C:/Users/egrout/Dropbox/coatithon/coatithon_code/code_review/'
plot_dir <- 'C:/Users/egrout/Dropbox/coatithon/results/presedente_results/level1/'
id_file <- 'presedente_coati_ids.RData'  #level one is where May and Cleopatra have been changed to subadults
pres_gps_matrix <- 'presedente_matrix_10min_proptimeinsamesubgroup_50m.txt' #saved from plot3c in fission_fusion_presedente
#read in the genetics matrix for all groups
all_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/CoatiTrioMLmatrix.csv', header = T)
#I manually made these matrices in excel - of the dyad are the same age/sex, they get 1, if different, they get 0
#load from GoogleDrive
sex_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/presedente/pres_sex_matrix.csv', header = T)
age_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/presedente/pres_age_matrix.csv', header = T)
#read in library of functions
setwd(code_dir)
source('coati_function_library_V1.R')
#load data
setwd(data_dir)
load(id_file)
pres_matrix <- read.table(pres_gps_matrix, header = T)
#make subgroup membership matrix a matrix
pres_matrix <- as.matrix(pres_matrix)
diag(pres_matrix) <- NA
#order - without Wildflower AND males:
#new_order <- c(1,9,10,3,4,12,2,11,7,5,13,16,8,15,6,14)
#ardern, merkel, moscoso, cleopatra, gandhi, obama, castro, mujica, may, khan, peron, zelenskyy, meir, truss, gillard, torrijos
#Presidente ID codes to subset correct individuals from genetics matrix
# B12 - Ardern
# B17 - Merkel
# B16 - Moscoso
# B09 - Cleopatra
# B03 - Gandhi
# B01 - Obama
# B02 - Castro
# B04 - Mujica
# B14 - May
# B10 - Khan
# B07 - Peron
# B05 - Zelenskyy
# B06 - Meir
# B13 - Truss
# B11 - Gillard
# B15 - Torrijos
#ardern, merkel, moscoso, cleopatra, gandhi, obama, castro, mujica, may, khan, peron, zelenskyy, meir, truss, gillard, torrijos
pres_inds_neworder <- c("B12.L001", "B17.L001", "B16.L001", "B09.L001", "B03.L001", "B01.L001", "B02.L001", "B04.L001", "B14.L001", "B10.L001", "B07.L001", "B05.L001", "B06.L001", "B13.L001", "B11.L001", "B15.L001")
pres_neworder_indx <- c(1,9,10,3,4,12,2,11,7,5,13,16,8,15,6,14) #order for coati_ids when adult males are not in the group
#first column is index numbers but I want this to be the IDs
rownames(all_matrix) <- all_matrix$X
#remove first column as this is incorrect for the subsetting to work
all_matrix <- all_matrix[,-1]
gen_matrix <- all_matrix[pres_inds_neworder, pres_inds_neworder]
gen_matrix <- as.matrix(gen_matrix)
diag(gen_matrix) <- NA
#removing males and Wildflower from coati_ids so I can visualise the relatedness
coati_ids_cut <- coati_ids[-c(5, 8, 9, 10, 18, 21),]
#figure 3d
n_inds <- 16
png(height = 600, width = 650, units = 'px', filename = paste0(plot_dir,'pres_genetics.png'))
visualize_network_matrix_presedente(gen_matrix, coati_ids_cut[pres_neworder_indx,])
dev.off()
#make age and sex matrices actual matrices:
# order of sex/age matrix (same as coati_ids order): ardern, merkel, moscoso, cleopatra, gandhi, obama, castro, mujica, may, khan, peron, zelenskyy, meir, truss, gillard, torrijos
rownames(age_matrix) <- age_matrix$X
age_matrix <- age_matrix[,-1]
age_matrix <- as.matrix(age_matrix)
diag(age_matrix) <- NA
rownames(sex_matrix) <- sex_matrix$X
sex_matrix <- sex_matrix[,-1]
sex_matrix <- as.matrix(sex_matrix)
diag(sex_matrix) <- NA
setwd(plot_dir)
#rename Ardern in coati_ids_cut
coati_ids_cut$name[coati_ids_cut$name == "Ardera"] <- "Ardern"
#png(height = 900, width = 1400, units = 'px', filename = paste0(plot_dir,'all_matrices.png'))
par(mfrow=c(2,2))
visualize_network_matrix_presedente(pres_matrix, coati_ids_cut[pres_neworder_indx,])
mtext("1) Proportion of time each dyad was in the same subgroup", cex = 1.2)
visualize_network_matrix_presedente(age_matrix, coati_ids_cut[pres_neworder_indx,])
mtext("2) Age homophily", cex = 1.2)
visualize_network_matrix_presedente(sex_matrix, coati_ids_cut[pres_neworder_indx,])
mtext("3) Sex homophily", cex = 1.2)
visualize_network_matrix_presedente(gen_matrix, coati_ids_cut[pres_neworder_indx,])
mtext("4) Genetics - Triadic Maximum Likelihood method", cex = 1.2)
#dev.off()
#save these matrices to send to Tiffany
save(pres_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_subgrouping.Rdata')
save(age_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_age.Rdata')
save(sex_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_sex.Rdata')
pres_gen_matrix <- gen_matrix
save(gen_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_relatedness.Rdata')
pres_ids <- coati_ids_cut[pres_neworder_indx,]
save(pres_ids, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_ids.Rdata')
#MRQAP with Double-Semi-Partialing (DSP)
set.seed(2)
#table 2
mod <- mrqap.dsp(pres_matrix~age_matrix+sex_matrix+gen_matrix, directed="undirected", diagonal = F)
#-----------------------------------------------------------------------
#reordering the matrices to age/sex class to visualise th differences more clearly, this plot will not go in the paper as the order of the subgrouping matrix would not be as clear
#ardern, merkel, truss, moscoso, cleopatra, may, peron, gillard, torrijos, khan, gandhi, obama, mujica, castro, zelenskyy, meir
pres_inds_neworder_agesex <- c("B12.L001", "B17.L001", "B13.L001", "B16.L001", "B09.L001", "B14.L001",  "B07.L001", "B11.L001", "B15.L001","B10.L001", "B03.L001", "B01.L001","B04.L001",  "B02.L001",  "B05.L001", "B06.L001")
pres_neworder_indx_agesex <- c(1,9,15,10,3,7,13,6,14,5,4,12,11,2,16,8)
gen_matrix_agesex <- all_matrix[pres_inds_neworder_agesex, pres_inds_neworder_agesex]
gen_matrix_agesex  <- as.matrix(gen_matrix_agesex)
diag(gen_matrix_agesex) <- NA
n_inds <- 16
png(height = 600, width = 650, units = 'px', filename = paste0(plot_dir,'pres_genetics_agesexorder.png'))
visualize_network_matrix_presedente(gen_matrix_agesex, coati_ids_cut[pres_neworder_indx_agesex,])
dev.off()
#-----------------------------------------------------------------------
#make plot with dyadic strength against relatedness
#figure S6
png(height = 1000, width = 1000, units = 'px', filename = paste0(plot_dir,'gen_pres_scatter_2.png'))
par(mar=c(8,8,6,3), mgp=c(5,1.2,0))
gen_vec <- gen_matrix[upper.tri(gen_matrix)]
pres_vec <- pres_matrix[upper.tri(pres_matrix)]
df <- data.frame(cbind(gen_vec, pres_vec))
plot(df$gen_vec, df$pres_vec, ylab = "Proportion of time together", xlab = "Relatedness (Triadic Maximum Likelihood)", pch = 19, col = "aquamarine3", cex = 3, cex.lab = 3, cex.axis = 2.5, yaxt = "n", ylim = c(0.3, 1))
axis(2, at = c(0,0.3,0.6,0.9), cex.axis = 3, las = 1)
abline(lm(pres_vec ~ gen_vec, data = data.frame(df)), col = "black", lwd = 2)
#str(summary(lm(pres_vec ~ gen_vec, data = data.frame(df)))) #rsquared 0.0885
dev.off()
#this script is for the MRQAP analysis for Presidente group
#load in libraries
library(sna)
library(asnipe)
library(abind)
library(fields)
library(ecodist)
library(vegan)
data_dir <- "C:/Users/egrout/Dropbox/coatithon/processed/2023/presedente/"
code_dir <- 'C:/Users/egrout/Dropbox/coatithon/coatithon_code/code_review/'
plot_dir <- 'C:/Users/egrout/Dropbox/coatithon/results/presedente_results/level1/'
id_file <- 'presedente_coati_ids.RData'  #level one is where May and Cleopatra have been changed to subadults
pres_gps_matrix <- 'presedente_matrix_10min_proptimeinsamesubgroup_50m.txt' #saved from plot3c in fission_fusion_presedente
#read in the genetics matrix for all groups
all_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/CoatiTrioMLmatrix.csv', header = T)
#I manually made these matrices in excel - of the dyad are the same age/sex, they get 1, if different, they get 0
#load from GoogleDrive
sex_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/presedente/pres_sex_matrix.csv', header = T)
age_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/presedente/pres_age_matrix.csv', header = T)
#read in library of functions
setwd(code_dir)
source('coati_function_library_V1.R')
#load data
setwd(data_dir)
load(id_file)
pres_matrix <- read.table(pres_gps_matrix, header = T)
#make subgroup membership matrix a matrix
pres_matrix <- as.matrix(pres_matrix)
diag(pres_matrix) <- NA
#order - without Wildflower AND males:
#new_order <- c(1,9,10,3,4,12,2,11,7,5,13,16,8,15,6,14)
#ardern, merkel, moscoso, cleopatra, gandhi, obama, castro, mujica, may, khan, peron, zelenskyy, meir, truss, gillard, torrijos
#Presidente ID codes to subset correct individuals from genetics matrix
# B12 - Ardern
# B17 - Merkel
# B16 - Moscoso
# B09 - Cleopatra
# B03 - Gandhi
# B01 - Obama
# B02 - Castro
# B04 - Mujica
# B14 - May
# B10 - Khan
# B07 - Peron
# B05 - Zelenskyy
# B06 - Meir
# B13 - Truss
# B11 - Gillard
# B15 - Torrijos
#ardern, merkel, moscoso, cleopatra, gandhi, obama, castro, mujica, may, khan, peron, zelenskyy, meir, truss, gillard, torrijos
pres_inds_neworder <- c("B12.L001", "B17.L001", "B16.L001", "B09.L001", "B03.L001", "B01.L001", "B02.L001", "B04.L001", "B14.L001", "B10.L001", "B07.L001", "B05.L001", "B06.L001", "B13.L001", "B11.L001", "B15.L001")
pres_neworder_indx <- c(1,9,10,3,4,12,2,11,7,5,13,16,8,15,6,14) #order for coati_ids when adult males are not in the group
#first column is index numbers but I want this to be the IDs
rownames(all_matrix) <- all_matrix$X
#remove first column as this is incorrect for the subsetting to work
all_matrix <- all_matrix[,-1]
gen_matrix <- all_matrix[pres_inds_neworder, pres_inds_neworder]
gen_matrix <- as.matrix(gen_matrix)
diag(gen_matrix) <- NA
#removing males and Wildflower from coati_ids so I can visualise the relatedness
coati_ids_cut <- coati_ids[-c(5, 8, 9, 10, 18, 21),]
#figure 3d
n_inds <- 16
png(height = 600, width = 650, units = 'px', filename = paste0(plot_dir,'pres_genetics.png'))
visualize_network_matrix_presedente(gen_matrix, coati_ids_cut[pres_neworder_indx,])
dev.off()
#make age and sex matrices actual matrices:
# order of sex/age matrix (same as coati_ids order): ardern, merkel, moscoso, cleopatra, gandhi, obama, castro, mujica, may, khan, peron, zelenskyy, meir, truss, gillard, torrijos
rownames(age_matrix) <- age_matrix$X
age_matrix <- age_matrix[,-1]
age_matrix <- as.matrix(age_matrix)
diag(age_matrix) <- NA
rownames(sex_matrix) <- sex_matrix$X
sex_matrix <- sex_matrix[,-1]
sex_matrix <- as.matrix(sex_matrix)
diag(sex_matrix) <- NA
setwd(plot_dir)
#rename Ardern in coati_ids_cut
coati_ids_cut$name[coati_ids_cut$name == "Ardera"] <- "Ardern"
#png(height = 900, width = 1400, units = 'px', filename = paste0(plot_dir,'all_matrices.png'))
par(mfrow=c(2,2))
visualize_network_matrix_presedente(pres_matrix, coati_ids_cut[pres_neworder_indx,])
mtext("1) Proportion of time each dyad was in the same subgroup", cex = 1.2)
visualize_network_matrix_presedente(age_matrix, coati_ids_cut[pres_neworder_indx,])
mtext("2) Age homophily", cex = 1.2)
visualize_network_matrix_presedente(sex_matrix, coati_ids_cut[pres_neworder_indx,])
mtext("3) Sex homophily", cex = 1.2)
visualize_network_matrix_presedente(gen_matrix, coati_ids_cut[pres_neworder_indx,])
mtext("4) Genetics - Triadic Maximum Likelihood method", cex = 1.2)
#dev.off()
#save these matrices to send to Tiffany
save(pres_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_subgrouping.Rdata')
save(age_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_age.Rdata')
save(sex_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_sex.Rdata')
pres_gen_matrix <- gen_matrix
save(pres_gen_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_relatedness.Rdata')
pres_ids <- coati_ids_cut[pres_neworder_indx,]
save(pres_ids, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/pres_ids.Rdata')
#MRQAP with Double-Semi-Partialing (DSP)
set.seed(2)
#table 2
mod <- mrqap.dsp(pres_matrix~age_matrix+sex_matrix+gen_matrix, directed="undirected", diagonal = F)
#-----------------------------------------------------------------------
#reordering the matrices to age/sex class to visualise th differences more clearly, this plot will not go in the paper as the order of the subgrouping matrix would not be as clear
#ardern, merkel, truss, moscoso, cleopatra, may, peron, gillard, torrijos, khan, gandhi, obama, mujica, castro, zelenskyy, meir
pres_inds_neworder_agesex <- c("B12.L001", "B17.L001", "B13.L001", "B16.L001", "B09.L001", "B14.L001",  "B07.L001", "B11.L001", "B15.L001","B10.L001", "B03.L001", "B01.L001","B04.L001",  "B02.L001",  "B05.L001", "B06.L001")
pres_neworder_indx_agesex <- c(1,9,15,10,3,7,13,6,14,5,4,12,11,2,16,8)
gen_matrix_agesex <- all_matrix[pres_inds_neworder_agesex, pres_inds_neworder_agesex]
gen_matrix_agesex  <- as.matrix(gen_matrix_agesex)
diag(gen_matrix_agesex) <- NA
n_inds <- 16
png(height = 600, width = 650, units = 'px', filename = paste0(plot_dir,'pres_genetics_agesexorder.png'))
visualize_network_matrix_presedente(gen_matrix_agesex, coati_ids_cut[pres_neworder_indx_agesex,])
dev.off()
#-----------------------------------------------------------------------
#make plot with dyadic strength against relatedness
#figure S6
png(height = 1000, width = 1000, units = 'px', filename = paste0(plot_dir,'gen_pres_scatter_2.png'))
par(mar=c(8,8,6,3), mgp=c(5,1.2,0))
gen_vec <- gen_matrix[upper.tri(gen_matrix)]
pres_vec <- pres_matrix[upper.tri(pres_matrix)]
df <- data.frame(cbind(gen_vec, pres_vec))
plot(df$gen_vec, df$pres_vec, ylab = "Proportion of time together", xlab = "Relatedness (Triadic Maximum Likelihood)", pch = 19, col = "aquamarine3", cex = 3, cex.lab = 3, cex.axis = 2.5, yaxt = "n", ylim = c(0.3, 1))
axis(2, at = c(0,0.3,0.6,0.9), cex.axis = 3, las = 1)
abline(lm(pres_vec ~ gen_vec, data = data.frame(df)), col = "black", lwd = 2)
#str(summary(lm(pres_vec ~ gen_vec, data = data.frame(df)))) #rsquared 0.0885
dev.off()
code_dir <- 'C:/Users/egrout/Dropbox/coatithon/coatithon_code/'
#read in library of functions
setwd(code_dir)
source('coati_function_library.R')
all_matrix <- read.csv('C:/Users/egrout/Dropbox/coatithon/processed/genetics/CoatiTrioMLmatrix.csv', header = T)
#first column is index numbers but I want this to be the IDs
rownames(all_matrix) <- all_matrix$X
#remove first column as this is incorrect for the subsetting to work
all_matrix <- all_matrix[,-1]
#load in ID files
load("C:/Users/egrout/Dropbox/coatithon/processed/2022/trago/trago_coati_ids_all.RData")
#adding Gin
trago_withGin <- rbind(coati_ids, list('Gin', 'na', 'Adult', 'Female', '#FF0000'))
#adding Absynth
trago_withGin <- rbind(trago_withGin, list('Absynthe', 'na', 'Adult', 'Female', '#FF0000'))
load("C:/Users/egrout/Dropbox/coatithon/processed/2022/galaxy/galaxy_coati_ids.RData")
#adding Sol to coati_ids
galaxy_withSOl <- rbind(coati_ids, list('Sol', 'na', 'Adult', 'Female', '#FF0000'))
load("C:/Users/egrout/Dropbox/coatithon/processed/2023/presedente/presedente_coati_ids.RData")
pres_ids <- coati_ids
# G8 - Tequila
# G9 - Gin
# G32 - Bailey
# G33 - Rum
# G34 - Whisky
# G35 - Sake
# G36 - Amarulla
# G37 - Tiger
# G38 - Limoncello
# G39 - Cerveza
# Absinthe.L001 - Absinthe
trago_neworder_indx <- c(2,3,7:9,1,5,4,6,10,11)
trago_inds_neworder <- c("G36", "G38", "G34", "G39", "G35", "G37", "G32", "G33", "G8", "G9", "Absinthe.L001")
trago_withGin_ordered <- trago_withGin[trago_neworder_indx,]
# G1 -  Sol
# G2 -  Estrella
# G3 -  Luna
# G10 - Gus
# G11 - Saturno
# G12 - Venus
# G13 - Orbita
# G14 - Pluto
# G15 - Cometa
# G16 - Lucero
# G17 - Planeta
# G18 - Quasar
#gus, quasar, sol, cometa, lucero, luna, estrella, venus, orbita, planeta, saturno, pluto
gal_inds_neworder <- c("G10", "G18", "G1", "G15C", "G16", "G3", "G15B","G12", "G13", "G17", "G11", "G14")
gal_neworder_indx <-  c(5,1,12,11,4,10,2,3,6,7,8,9)
galaxy_withSOl_ordered <- galaxy_withSOl[gal_neworder_indx,]
#Presidente ID codes to subset correct individuals from genetics matrix
# B12 - Ardern
# B17 - Merkel
# B16 - Moscoso
# B09 - Cleopatra
# B03 - Gandhi
# B01 - Obama
# B02 - Castro
# B04 - Mujica
# B14 - May
# B10 - Khan
# B07 - Peron
# B05 - Zelenskyy
# B06 - Meir
# B13 - Truss
# B11 - Gillard
# B15 - Torrijos
# B08 - Mandela
# B18 - Lula
# B19 - Kenyatta
# B21 - Gendry
# B20 - Sam
# B22 - Wildflower
#ardern, merkel, moscoso, cleopatra, gandhi, obama, castro, mujica, may, khan, peron, zelenskyy, meir, truss, gillard, torrijos, mandela, lula, kenyatta, gendry, sam, wildflower
pres_inds_neworder <- c("B12.L001", "B17.L001", "B16.L001", "B09.L001", "B03.L001", "B01.L001", "B02.L001", "B04.L001", "B14.L001", "B10.L001", "B07.L001", "B05.L001", "B06.L001", "B13.L001", "B11.L001", "B15.L001", "B08.L001", "B18.L001", "B19.L001", "B21.L001", "B20.L001", "B22.L001")
pres_neworder_indx <- c(1,13,14,3,4,16,2,15,11,6,17,22,12,20,7,19, 10,9,8,5,18,21)
pres_ids_ordered <- pres_ids[pres_neworder_indx,]
#first need to rbind the coati IDs to make one table for all inds
all_ids <- rbind(trago_withGin_ordered, galaxy_withSOl_ordered, pres_ids_ordered)
#then need to match this order with the genetic codes to subset the data
all_neworder <- c("G36", "G38", "G34", "G39", "G35", "G37", "G32", "G33", "G8", "G9","Absinthe.L001", "G10", "G18", "G1", "G15C", "G16", "G3", "G15B","G12", "G13", "G17", "G11", "G14", "B12.L001", "B17.L001", "B16.L001", "B09.L001", "B03.L001", "B01.L001", "B02.L001", "B04.L001", "B14.L001", "B10.L001", "B07.L001", "B05.L001", "B06.L001", "B13.L001", "B11.L001", "B15.L001", "B08.L001", "B18.L001", "B19.L001", "B21.L001", "B20.L001", "B22.L001")
gen_matrix <- all_matrix[all_neworder, all_neworder]
gen_matrix <- as.matrix(gen_matrix)
diag(gen_matrix) <- NA
#need to change the rep value to -.018 in the visualize_network_matrix_galaxy function for the agesex dots to be in correct place
n_inds <- 45
visualize_network_matrix_galaxy(gen_matrix, all_ids)
dev.off()
visualize_network_matrix_galaxy(gen_matrix, all_ids)
all_ids
View(all_ids)
all_gen_matrix <- gen_matrix
save(all_ids, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/all_ids.Rdata')
all_gen_matrix <- gen_matrix
save(all_gen, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/all_gen_matrix.Rdata')
save(all_gen_matrix, file = 'C:/Users/egrout/Dropbox/coatithon/processed/microbiome/all_gen_matrix.Rdata')
View(all_gen_matrix)
View(all_ids)
